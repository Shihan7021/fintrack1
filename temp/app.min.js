(function(){var _0x8f3a=['Income','Expense','Salary','Gift','Bonus','Interest','Business Income','Others','Food','Transport','Utilities','Cash Withdraw','Health','Loans','Clothing','Household','Savings','Entertainment','transactions','users','collection','onSnapshot','query','doc','deleteDoc','addDoc','setDoc','serverTimestamp','getDoc','en-US','minimumFractionDigits','maximumFractionDigits','fromDate','toDate','filterCategory','amountRange','All Categories','option','value','textContent','appendChild','doughnut','Income','Expense','rgba(40, 167, 69, 0.8)','#ffffff','Income Breakdown','Expense Breakdown','bottom','display','title','responsive','plugins','legend','position','Rs.','toLocaleString','list-group-item','d-flex','justify-content-between','align-items-center','income-row','expense-row','innerHTML','strong','small','span','formatAmount','Are you sure you want to delete this transaction?','undoToast','block','none','Transaction restored successfully.','Failed to restore transaction. Please try again.','No transactions to export.','Type,Category,Amount,Date,Comment','text/csv;charset=utf-8;','transactions.csv','download','click','removeChild','revokeObjectURL'];var _0x4b7e=function(_0x8f3a,_0x4b7e){_0x8f3a=_0x8f3a-0x0;var _0x2c9d=_0x8f3a[_0x8f3a];return _0x2c9d;};var _0x2c9d=_0x4b7e;window._app_core={_transactions:[],_deletedTxn:null,_currentUserId:null,_incomeChart:null,_expenseChart:null,_unsubscribe:null,_incomeCategories:[_0x2c9d(0x2),_0x2c9d(0x3),_0x2c9d(0x4),_0x2c9d(0x5),_0x2c9d(0x6),_0x2c9d(0x7)],_expenseCategories:[_0x2c9d(0x8),_0x2c9d(0x9),_0x2c9d(0xa),_0x2c9d(0xb),_0x2c9d(0xc),_0x2c9d(0xd),_0x2c9d(0xe),_0x2c9d(0xf),_0x2c9d(0x10),_0x2c9d(0x11),_0x2c9d(0x7)],init:async function(){try{window._fb_inst=await window._init_fb();window._auth_mgr.init(window._fb_inst.auth);this._setupRealtimeListener();}catch(_0x5e8a){console.error('App init failed:',_0x5e8a);}},_setupRealtimeListener:function(){window._auth_mgr.onAuthChange((_0x7f1b)=>{if(this._unsubscribe){this._unsubscribe();}if(_0x7f1b){this._currentUserId=_0x7f1b.uid;this._listenToTransactions();}else{this._currentUserId=null;this._transactions=[];this._renderDashboard();if(window.location.pathname!=='/'&&!window.location.pathname.includes('index.html')){window.location.href='index.html';}}});},_listenToTransactions:async function(){try{const{collection:_0x9a2c,onSnapshot:_0x3d4e,query:_0x6f5b}=await import(window._fb_urls.firestore);const _0x8c7d=_0x9a2c(window._fb_inst.db,_0x2c9d(0x13),this._currentUserId,_0x2c9d(0x12));this._unsubscribe=_0x3d4e(_0x6f5b(_0x8c7d),(_0x1e9f)=>{this._transactions=_0x1e9f.docs.map(_0x4a6b=>({id:_0x4a6b.id,..._0x4a6b.data()}));this._renderDashboard();},(_0x7c8e)=>{console.error('Error listening to transactions:',_0x7c8e);});}catch(_0x5b9a){console.error('Error setting up listener:',_0x5b9a);}},formatAmount:function(_0x3e7c){return parseFloat(_0x3e7c)[_0x2c9d(0x1d)](_0x2c9d(0x1c),{[_0x2c9d(0x1e)]:2,[_0x2c9d(0x1f)]:2});},_populateCategoryFilter:function(){const _0x8d1a=document.getElementById(_0x2c9d(0x22));const _0x9b2b=[...new Set(this._transactions.map(_0x4c7e=>_0x4c7e.category).filter(Boolean))];_0x8d1a[_0x2c9d(0x28)]=_0x2c9d(0x24);_0x9b2b.forEach(_0x5f8c=>{const _0x7e9d=document.createElement(_0x2c9d(0x25));_0x7e9d[_0x2c9d(0x26)]=_0x5f8c;_0x7e9d[_0x2c9d(0x27)]=_0x5f8c;_0x8d1a[_0x2c9d(0x29)](_0x7e9d);});},_filterTransactions:function(){const _0x6a8e=document.getElementById(_0x2c9d(0x20))[_0x2c9d(0x26)];const _0x4d7f=document.getElementById(_0x2c9d(0x21))[_0x2c9d(0x26)];const _0x8c6a=document.getElementById(_0x2c9d(0x22))[_0x2c9d(0x26)];const _0x1f9b=document.getElementById(_0x2c9d(0x23))[_0x2c9d(0x26)].trim();let _0x5e7c=null,_0x9d8a=null;if(_0x1f9b){const _0x3b6d=_0x1f9b.split('-');if(_0x3b6d.length===2){_0x5e7c=parseFloat(_0x3b6d[0]);_0x9d8a=parseFloat(_0x3b6d[1]);}}return this._transactions.filter(_0x7a5f=>{if(_0x6a8e&&_0x7a5f.date<_0x6a8e)return false;if(_0x4d7f&&_0x7a5f.date>_0x4d7f)return false;if(_0x8c6a&&_0x7a5f.category!==_0x8c6a)return false;const _0x2e8b=parseFloat(_0x7a5f.amount);if(_0x5e7c!==null&&!isNaN(_0x5e7c)&&_0x2e8b<_0x5e7c)return false;if(_0x9d8a!==null&&!isNaN(_0x9d8a)&&_0x2e8b>_0x9d8a)return false;return true;});},_renderCharts:function(_0x4f6c){const _0x8e9a={};const _0x1d7b={};_0x4f6c.forEach(_0x5c8d=>{if(_0x5c8d.type===_0x2c9d(0x0)){_0x8e9a[_0x5c8d.category]=(_0x8e9a[_0x5c8d.category]||0)+parseFloat(_0x5c8d.amount);}else if(_0x5c8d.type===_0x2c9d(0x1)){_0x1d7b[_0x5c8d.category]=(_0x1d7b[_0x5c8d.category]||0)+parseFloat(_0x5c8d.amount);}});const _0x9f3e=Object.keys(_0x8e9a);const _0x6a7f=_0x9f3e.map(_0x4b8c=>_0x8e9a[_0x4b8c]);const _0x2d5a=Object.keys(_0x1d7b);const _0x8c1b=_0x2d5a.map(_0x7e6d=>_0x1d7b[_0x7e6d]);if(this._incomeChart)this._incomeChart.destroy();if(this._expenseChart)this._expenseChart.destroy();const _0x5f9c=document.getElementById('incomeChart').getContext('2d');this._incomeChart=new Chart(_0x5f9c,{type:_0x2c9d(0x2a),data:{labels:_0x9f3e,datasets:[{label:_0x2c9d(0x2b),data:_0x6a7f,backgroundColor:_0x9f3e.map(()=>_0x2c9d(0x2d)),borderColor:_0x9f3e.map(()=>_0x2c9d(0x2e)),borderWidth:1}]},options:{[_0x2c9d(0x35)]:true,[_0x2c9d(0x36)]:{[_0x2c9d(0x37)]:{[_0x2c9d(0x38)]:_0x2c9d(0x33)},[_0x2c9d(0x34)]:{[_0x2c9d(0x32)]:true,text:_0x2c9d(0x2f)}}}});const _0x8d4e=document.getElementById('expenseChart').getContext('2d');this._expenseChart=new Chart(_0x8d4e,{type:_0x2c9d(0x2a),data:{labels:_0x2d5a,datasets:[{label:_0x2c9d(0x2c),data:_0x8c1b,backgroundColor:_0x2d5a.map(()=>'#cc0000cc'),borderColor:_0x2d5a.map(()=>_0x2c9d(0x2e)),borderWidth:1}]},options:{[_0x2c9d(0x35)]:true,[_0x2c9d(0x36)]:{[_0x2c9d(0x37)]:{[_0x2c9d(0x38)]:_0x2c9d(0x33)},[_0x2c9d(0x34)]:{[_0x2c9d(0x32)]:true,text:_0x2c9d(0x30)}}}});},_renderSummaryTable:function(_0x7d8f){const _0x6c9e=document.getElementById('summaryTable');let _0x5a7c=0;let _0x8f6d=0;_0x7d8f.forEach(_0x4e5b=>{if(_0x4e5b.type===_0x2c9d(0x0))_0x5a7c+=parseFloat(_0x4e5b.amount);else if(_0x4e5b.type===_0x2c9d(0x1))_0x8f6d+=parseFloat(_0x4e5b.amount);});_0x6c9e[_0x2c9d(0x3c)]='<div class="mb-4"><h4>Summary</h4><p><strong>Total Income:</strong> '+_0x2c9d(0x39)+this.formatAmount(_0x5a7c)+'</p><p><strong>Total Expense:</strong> '+_0x2c9d(0x39)+this.formatAmount(_0x8f6d)+'</p><p><strong>Balance:</strong> '+_0x2c9d(0x39)+this.formatAmount(_0x5a7c-_0x8f6d)+'</p></div>';},_renderRecentTransactions:function(){const _0x9e7a=document.getElementById('recentTransactions');_0x9e7a[_0x2c9d(0x3c)]='';const _0x6f8b=[...this._transactions].sort((_0x5d9c,_0x8a7e)=>_0x8a7e.date.localeCompare(_0x5d9c.date));const _0x4c6f=_0x6f8b.slice(0,10);_0x4c6f.forEach(_0x7b8d=>{const _0x9a5e=document.createElement('li');_0x9a5e.className=_0x2c9d(0x3a)+' '+_0x2c9d(0x3b)+' '+(_0x7b8d.type===_0x2c9d(0x0)?_0x2c9d(0x3f):_0x2c9d(0x40));_0x9a5e[_0x2c9d(0x3c)]='<div><'+_0x2c9d(0x41)+'>'+_0x7b8d.type+'</'+_0x2c9d(0x41)+'> - '+_0x7b8d.category+' <br /><'+_0x2c9d(0x42)+'>'+_0x7b8d.date+'</'+_0x2c9d(0x42)+'><br /><'+_0x2c9d(0x42)+'>'+((_0x7b8d.comment||''))+'</'+_0x2c9d(0x42)+'></div><'+_0x2c9d(0x43)+'>'+_0x2c9d(0x39)+this[_0x2c9d(0x44)](_0x7b8d.amount)+'</'+_0x2c9d(0x43)+'>';_0x9e7a[_0x2c9d(0x29)](_0x9a5e);});},_renderDashboard:function(){const _0x8c5d=this._filterTransactions();this._populateCategoryFilter();this._renderCharts(_0x8c5d);this._renderSummaryTable(_0x8c5d);this._renderRecentTransactions();},deleteTxn:async function(_0x6d4a){if(!window._auth_mgr.requireAuth())return;if(confirm(_0x2c9d(0x45))){try{const _0x9f7b=this._transactions.find(_0x5e8c=>_0x5e8c.id===_0x6d4a);if(_0x9f7b){this._deletedTxn={..._0x9f7b};}const{doc:_0x8a6d,deleteDoc:_0x4c7e}=await import(window._fb_urls.firestore);await _0x4c7e(_0x8a6d(window._fb_inst.db,_0x2c9d(0x13),this._currentUserId,_0x2c9d(0x12),_0x6d4a));this._showUndoToast();}catch(_0x7f9c){console.error('Error deleting document:',_0x7f9c);alert('Failed to delete transaction. Please try again.');}}},_showUndoToast:function(){const _0x5d8e=document.getElementById(_0x2c9d(0x46));if(_0x5d8e){_0x5d8e.style[_0x2c9d(0x31)]=_0x2c9d(0x47);setTimeout(()=>{_0x5d8e.style[_0x2c9d(0x31)]=_0x2c9d(0x48);this._deletedTxn=null;},5000);}},undoDelete:async function(){if(this._deletedTxn&&this._currentUserId){try{const{id:_0x6f8c,..._0x9e7d}=this._deletedTxn;const{collection:_0x8a5f,addDoc:_0x4d6e}=await import(window._fb_urls.firestore);await _0x4d6e(_0x8a5f(window._fb_inst.db,_0x2c9d(0x13),this._currentUserId,_0x2c9d(0x12)),_0x9e7d);document.getElementById(_0x2c9d(0x46)).style[_0x2c9d(0x31)]=_0x2c9d(0x48);this._deletedTxn=null;alert(_0x2c9d(0x49));}catch(_0x7c5a){console.error('Error restoring transaction:',_0x7c5a);alert(_0x2c9d(0x4a));}}},exportTransactions:function(){if(!this._transactions.length){alert(_0x2c9d(0x4b));return;}let _0x8f4c=_0x2c9d(0x4c);this._transactions.forEach(_0x6e9d=>{const _0x5a8e=_0x6e9d.comment?'"'+_0x6e9d.comment.replace(/"/g,'""')+'"':'';_0x8f4c+=_0x6e9d.type+','+_0x6e9d.category+','+_0x6e9d.amount+','+_0x6e9d.date+','+_0x5a8e+'\n';});const _0x9c7f=new Blob([_0x8f4c],{type:_0x2c9d(0x4d)});const _0x4e8a=URL.createObjectURL(_0x9c7f);const _0x7d6b=document.createElement('a');_0x7d6b.href=_0x4e8a;_0x7d6b.setAttribute(_0x2c9d(0x4f),_0x2c9d(0x4e));document.body[_0x2c9d(0x29)](_0x7d6b);_0x7d6b[_0x2c9d(0x50)]();document.body[_0x2c9d(0x51)](_0x7d6b);URL[_0x2c9d(0x52)](_0x4e8a);},filterData:function(){const _0x8d7c=this._filterTransactions();this._renderCharts(_0x8d7c);this._renderSummaryTable(_0x8d7c);this._renderRecentTransactions();}};window.filterData=()=>window._app_core.filterData();window.exportTransactions=()=>window._app_core.exportTransactions();window.deleteTxn=(_0x6a9e)=>window._app_core.deleteTxn(_0x6a9e);window.undoDelete=()=>window._app_core.undoDelete();})();
