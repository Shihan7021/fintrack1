<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Profile - MindPay</title>
    <link rel="icon" type="image/png" href="favicon.png" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="theme.css" />
    <style>
        body {
            background-color: #f8f9fa;
        }
        .profile-nav .nav-link {
            color: #495057;
            border-radius: 0.25rem;
            margin-bottom: 0.5rem;
        }
        .profile-nav .nav-link.active {
            color: #fff;
            background-color: #3C0775;
        }
        .profile-nav .nav-link:hover {
            background-color: #e9ecef;
        }
        .card {
            border: none;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        }
        .form-label {
            font-weight: 600;
        }
        .btn-primary {
            background-color: #3C0775;
            border-color: #3C0775;
        }
        .btn-primary:hover {
            background-color: #7454AC;
            border-color: #7454AC;
        }
        .form-control[readonly] {
            background-color: #e9ecef;
            opacity: 1;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center" href="dashboard.html">
                <img src="logo-head.png" alt="FinSight Logo" class="logo-header">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="dashboard.html"><i class="fas fa-home"></i> Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="input.html"><i class="fas fa-plus-circle"></i> Add Transaction</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="history.html"><i class="fas fa-list"></i> All Transactions</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="budget.html"><i class="fas fa-chart-pie"></i> Budget</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="analyze.html"><i class="fas fa-chart-line"></i> Analyze</a>
                    </li>
                    <li class="nav-item" style="display: none;">
                        <a class="nav-link" href="what-if-search.html"><i class="fas fa-search"></i> What If</a>
                    </li>
                    <li class="nav-item" style="display: none;">
                        <a class="nav-link" href="bank-statement-upload.html"><i class="fas fa-upload"></i> Upload Statement</a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="logoutButton"><i class="fas fa-sign-out-alt"></i> Logout</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <div class="row">
            <div class="col-lg-3">
                <div class="card profile-nav">
                    <div class="card-body">
                        <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                            <a class="nav-link active" id="v-pills-profile-tab" data-bs-toggle="pill" href="#v-pills-profile" role="tab" aria-controls="v-pills-profile" aria-selected="true">
                                <i class="fas fa-user me-2"></i>Personal Information
                            </a>
                            <a class="nav-link" id="v-pills-financial-tab" data-bs-toggle="pill" href="#v-pills-financial" role="tab" aria-controls="v-pills-financial" aria-selected="false">
                                <i class="fas fa-dollar-sign me-2"></i>Financial Information
                            </a>
                            <a class="nav-link" id="v-pills-categories-tab" data-bs-toggle="pill" href="#v-pills-categories" role="tab" aria-controls="v-pills-categories" aria-selected="false">
                                <i class="fas fa-th-list me-2"></i>Categories
                            </a>
                            <a class="nav-link" id="v-pills-preferences-tab" data-bs-toggle="pill" href="#v-pills-preferences" role="tab" aria-controls="v-pills-preferences" aria-selected="false">
                                <i class="fas fa-cog me-2"></i>Preferences
                            </a>
                            <a class="nav-link" id="v-pills-billing-tab" data-bs-toggle="pill" href="#v-pills-billing" role="tab" aria-controls="v-pills-billing" aria-selected="false">
                                <i class="fas fa-credit-card me-2"></i>Billing & Subscription
                            </a>
                            <a class="nav-link" id="v-pills-security-tab" data-bs-toggle="pill" href="#v-pills-security" role="tab" aria-controls="v-pills-security" aria-selected="false">
                                <i class="fas fa-lock me-2"></i>Security
                            </a>
                            <a class="nav-link" id="v-pills-danger-tab" data-bs-toggle="pill" href="#v-pills-danger" role="tab" aria-controls="v-pills-danger" aria-selected="false">
                                <i class="fas fa-exclamation-triangle me-2"></i>Danger Zone
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-9">
                <div class="tab-content" id="v-pills-tabContent">
                    <div class="tab-pane fade show active" id="v-pills-profile" role="tabpanel" aria-labelledby="v-pills-profile-tab">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title mb-4">Personal Information</h4>
                                <form id="profileForm">
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="profileFirstname" class="form-label">First Name</label>
                                            <input type="text" id="profileFirstname" class="form-control">
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="profileLastname" class="form-label">Last Name</label>
                                            <input type="text" id="profileLastname" class="form-control">
                                        </div>
                                        
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="profilePhone" class="form-label">Mobile Number</label>
                                            <input type="number" id="profilePhone" class="form-control">
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="profileEmail" class="form-label">Email</label>
                                            <input type="email" id="profileEmail" class="form-control" readonly />
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="profileProfession" class="form-label">Profession</label>
                                            <select id="profileProfession" class="form-select">
                                                <option value="">Select Profession</option>
                                                <option value="Student">Student</option>
                                                <option value="Employed">Employed</option>
                                                <option value="Self-Employed">Self-Employed</option>
                                                <option value="Business Owner">Business Owner</option>
                                                <option value="Freelancer">Freelancer</option>
                                                <option value="Retired">Retired</option>
                                                <option value="Unemployed">Unemployed</option>
                                                <option value="Other">Other</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="profileAgeRange" class="form-label">Age Range</label>
                                            <select id="profileAgeRange" class="form-select">
                                                <option value="">Select Age Range</option>
                                                <option value="18-25">18-25</option>
                                                <option value="26-35">26-35</option>
                                                <option value="36-45">36-45</option>
                                                <option value="46-55">46-55</option>
                                                <option value="56-65">56-65</option>
                                                <option value="65+">65+</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="profileCountry" class="form-label">Country</label>
                                            <select id="profileCountry" class="form-select">
                                                <option value="">Select Country</option>
                                                <option value="Afghanistan">Afghanistan</option>
                                                <option value="Albania">Albania</option>
                                                <option value="Algeria">Algeria</option>
                                                <option value="Andorra">Andorra</option>
                                                <option value="Angola">Angola</option>
                                                <option value="Antigua and Barbuda">Antigua and Barbuda</option>
                                                <option value="Argentina">Argentina</option>
                                                <option value="Armenia">Armenia</option>
                                                <option value="Australia">Australia</option>
                                                <option value="Austria">Austria</option>
                                                <option value="Azerbaijan">Azerbaijan</option>
                                                <option value="Bahamas">Bahamas</option>
                                                <option value="Bahrain">Bahrain</option>
                                                <option value="Bangladesh">Bangladesh</option>
                                                <option value="Barbados">Barbados</option>
                                                <option value="Belarus">Belarus</option>
                                                <option value="Belgium">Belgium</option>
                                                <option value="Belize">Belize</option>
                                                <option value="Benin">Benin</option>
                                                <option value="Bhutan">Bhutan</option>
                                                <option value="Bolivia">Bolivia</option>
                                                <option value="Bosnia and Herzegovina">Bosnia and Herzegovina</option>
                                                <option value="Botswana">Botswana</option>
                                                <option value="Brazil">Brazil</option>
                                                <option value="Brunei">Brunei</option>
                                                <option value="Bulgaria">Bulgaria</option>
                                                <option value="Burkina Faso">Burkina Faso</option>
                                                <option value="Burundi">Burundi</option>
                                                <option value="Cabo Verde">Cabo Verde</option>
                                                <option value="Cambodia">Cambodia</option>
                                                <option value="Cameroon">Cameroon</option>
                                                <option value="Canada">Canada</option>
                                                <option value="Central African Republic">Central African Republic</option>
                                                <option value="Chad">Chad</option>
                                                <option value="Chile">Chile</option>
                                                <option value="China">China</option>
                                                <option value="Colombia">Colombia</option>
                                                <option value="Comoros">Comoros</option>
                                                <option value="Congo, Democratic Republic of the">Congo, Democratic Republic of the</option>
                                                <option value="Congo, Republic of the">Congo, Republic of the</option>
                                                <option value="Costa Rica">Costa Rica</option>
                                                <option value="Cote d'Ivoire">Cote d'Ivoire</option>
                                                <option value="Croatia">Croatia</option>
                                                <option value="Cuba">Cuba</option>
                                                <option value="Cyprus">Cyprus</option>
                                                <option value="Czechia (Czech Republic)">Czechia (Czech Republic)</option>
                                                <option value="Denmark">Denmark</option>
                                                <option value="Djibouti">Djibouti</option>
                                                <option value="Dominica">Dominica</option>
                                                <option value="Dominican Republic">Dominican Republic</option>
                                                <option value="Ecuador">Ecuador</option>
                                                <option value="Egypt">Egypt</option>
                                                <option value="El Salvador">El Salvador</option>
                                                <option value="Equatorial Guinea">Equatorial Guinea</option>
                                                <option value="Eritrea">Eritrea</option>
                                                <option value="Estonia">Estonia</option>
                                                <option value="Eswatini (formerly Swaziland)">Eswatini (formerly Swaziland)</option>
                                                <option value="Ethiopia">Ethiopia</option>
                                                <option value="Fiji">Fiji</option>
                                                <option value="Finland">Finland</option>
                                                <option value="France">France</option>
                                                <option value="Gabon">Gabon</option>
                                                <option value="Gambia">Gambia</option>
                                                <option value="Georgia">Georgia</option>
                                                <option value="Germany">Germany</option>
                                                <option value="Ghana">Ghana</option>
                                                <option value="Greece">Greece</option>
                                                <option value="Grenada">Grenada</option>
                                                <option value="Guatemala">Guatemala</option>
                                                <option value="Guinea">Guinea</option>
                                                <option value="Guinea-Bissau">Guinea-Bissau</option>
                                                <option value="Guyana">Guyana</option>
                                                <option value="Haiti">Haiti</option>
                                                <option value="Honduras">Honduras</option>
                                                <option value="Hungary">Hungary</option>
                                                <option value="Iceland">Iceland</option>
                                                <option value="India">India</option>
                                                <option value="Indonesia">Indonesia</option>
                                                <option value="Iran">Iran</option>
                                                <option value="Iraq">Iraq</option>
                                                <option value="Ireland">Ireland</option>
                                                <option value="Israel">Israel</option>
                                                <option value="Italy">Italy</option>
                                                <option value="Jamaica">Jamaica</option>
                                                <option value="Japan">Japan</option>
                                                <option value="Jordan">Jordan</option>
                                                <option value="Kazakhstan">Kazakhstan</option>
                                                <option value="Kenya">Kenya</option>
                                                <option value="Kiribati">Kiribati</option>
                                                <option value="Kuwait">Kuwait</option>
                                                <option value="Kyrgyzstan">Kyrgyzstan</option>
                                                <option value="Laos">Laos</option>
                                                <option value="Latvia">Latvia</option>
                                                <option value="Lebanon">Lebanon</option>
                                                <option value="Lesotho">Lesotho</option>
                                                <option value="Liberia">Liberia</option>
                                                <option value="Libya">Libya</option>
                                                <option value="Liechtenstein">Liechtenstein</option>
                                                <option value="Lithuania">Lithuania</option>
                                                <option value="Luxembourg">Luxembourg</option>
                                                <option value="Madagascar">Madagascar</option>
                                                <option value="Malawi">Malawi</option>
                                                <option value="Malaysia">Malaysia</option>
                                                <option value="Maldives">Maldives</option>
                                                <option value="Mali">Mali</option>
                                                <option value="Malta">Malta</option>
                                                <option value="Marshall Islands">Marshall Islands</option>
                                                <option value="Mauritania">Mauritania</option>
                                                <option value="Mauritius">Mauritius</option>
                                                <option value="Mexico">Mexico</option>
                                                <option value="Micronesia">Micronesia</option>
                                                <option value="Moldova">Moldova</option>
                                                <option value="Monaco">Monaco</option>
                                                <option value="Mongolia">Mongolia</option>
                                                <option value="Montenegro">Montenegro</option>
                                                <option value="Morocco">Morocco</option>
                                                <option value="Mozambique">Mozambique</option>
                                                <option value="Myanmar (formerly Burma)">Myanmar (formerly Burma)</option>
                                                <option value="Namibia">Namibia</option>
                                                <option value="Nauru">Nauru</option>
                                                <option value="Nepal">Nepal</option>
                                                <option value="Netherlands">Netherlands</option>
                                                <option value="New Zealand">New Zealand</option>
                                                <option value="Nicaragua">Nicaragua</option>
                                                <option value="Niger">Niger</option>
                                                <option value="Nigeria">Nigeria</option>
                                                <option value="North Korea">North Korea</option>
                                                <option value="North Macedonia (formerly Macedonia)">North Macedonia (formerly Macedonia)</option>
                                                <option value="Norway">Norway</option>
                                                <option value="Oman">Oman</option>
                                                <option value="Pakistan">Pakistan</option>
                                                <option value="Palau">Palau</option>
                                                <option value="Palestine State">Palestine State</option>
                                                <option value="Panama">Panama</option>
                                                <option value="Papua New Guinea">Papua New Guinea</option>
                                                <option value="Paraguay">Paraguay</option>
                                                <option value="Peru">Peru</option>
                                                <option value="Philippines">Philippines</option>
                                                <option value="Poland">Poland</option>
                                                <option value="Portugal">Portugal</option>
                                                <option value="Qatar">Qatar</option>
                                                <option value="Romania">Romania</option>
                                                <option value="Russia">Russia</option>
                                                <option value="Rwanda">Rwanda</option>
                                                <option value="Saint Kitts and Nevis">Saint Kitts and Nevis</option>
                                                <option value="Saint Lucia">Saint Lucia</option>
                                                <option value="Saint Vincent and the Grenadines">Saint Vincent and the Grenadines</option>
                                                <option value="Samoa">Samoa</option>
                                                <option value="San Marino">San Marino</option>
                                                <option value="Sao Tome and Principe">Sao Tome and Principe</option>
                                                <option value="Saudi Arabia">Saudi Arabia</option>
                                                <option value="Senegal">Senegal</option>
                                                <option value="Serbia">Serbia</option>
                                                <option value="Seychelles">Seychelles</option>
                                                <option value="Sierra Leone">Sierra Leone</option>
                                                <option value="Singapore">Singapore</option>
                                                <option value="Slovakia">Slovakia</option>
                                                <option value="Slovenia">Slovenia</option>
                                                <option value="Solomon Islands">Solomon Islands</option>
                                                <option value="Somalia">Somalia</option>
                                                <option value="South Africa">South Africa</option>
                                                <option value="South Korea">South Korea</option>
                                                <option value="South Sudan">South Sudan</option>
                                                <option value="Spain">Spain</option>
                                                <option value="Sri Lanka">Sri Lanka</option>
                                                <option value="Sudan">Sudan</option>
                                                <option value="Suriname">Suriname</option>
                                                <option value="Sweden">Sweden</option>
                                                <option value="Switzerland">Switzerland</option>
                                                <option value="Syria">Syria</option>
                                                <option value="Taiwan">Taiwan</option>
                                                <option value="Tajikistan">Tajikistan</option>
                                                <option value="Tanzania">Tanzania</option>
                                                <option value="Thailand">Thailand</option>
                                                <option value="Timor-Leste">Timor-Leste</option>
                                                <option value="Togo">Togo</option>
                                                <option value="Tonga">Tonga</option>
                                                <option value="Trinidad and Tobago">Trinidad and Tobago</option>
                                                <option value="Tunisia">Tunisia</option>
                                                <option value="Turkey">Turkey</option>
                                                <option value="Turkmenistan">Turkmenistan</option>
                                                <option value="Tuvalu">Tuvalu</option>
                                                <option value="Uganda">Uganda</option>
                                                <option value="Ukraine">Ukraine</option>
                                                <option value="United Arab Emirates">United Arab Emirates</option>
                                                <option value="United Kingdom">United Kingdom</option>
                                                <option value="United States of America">United States of America</option>
                                                <option value="Uruguay">Uruguay</option>
                                                <option value="Uzbekistan">Uzbekistan</option>
                                                <option value="Vanuatu">Vanuatu</option>
                                                <option value="Venezuela">Venezuela</option>
                                                <option value="Vietnam">Vietnam</option>
                                                <option value="Yemen">Yemen</option>
                                                <option value="Zambia">Zambia</option>
                                                <option value="Zimbabwe">Zimbabwe</option>
                                                <option value="Other">Other</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="profileIncomeRange" class="form-label">Monthly Income Range</label>
                                            <select id="profileIncomeRange" class="form-select">
                                                <option value="">Select Income Range</option>
                                                <option value="0-50000">Rs. 0 - 50,000</option>
                                                <option value="50001-100000">Rs. 50,001 - 100,000</option>
                                                <option value="100001-200000">Rs. 100,001 - 200,000</option>
                                                <option value="200001-500000">Rs. 200,001 - 500,000</option>
                                                <option value="500001-1000000">Rs. 500,001 - 1,000,000</option>
                                                <option value="1000000+">Rs. 1,000,000+</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="profileCivilStatus" class="form-label">Civil Status</label>
                                            <select id="profileCivilStatus" class="form-select">
                                                <option value="">Select Civil Status</option>
                                                <option value="Single">Single</option>
                                                <option value="Married">Married</option>
                                                <option value="Divorced">Divorced</option>
                                                <option value="Widowed">Widowed</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="profileChildren" class="form-label">Number of Children</label>
                                            <input type="number" id="profileChildren" class="form-control" min="0">
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="profileLivingType" class="form-label">Living Type</label>
                                            <select id="profileLivingType" class="form-select">
                                                <option value="">Select Living Type</option>
                                                <option value="Rented">Rented</option>
                                                <option value="Owned">Owned</option>
                                                <option value="Leased">Leased</option>
                                                <option value="With Parents">With Parents</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="profileVehicleOwned" class="form-label">Vehicle Owned</label>
                                            <select id="profileVehicleOwned" class="form-select">
                                                <option value="">Select an option</option>
                                                <option value="Yes">Yes</option>
                                                <option value="No">No</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6 mb-3" id="profileFuelTypeContainer" style="display: none;">
                                            <label for="profileFuelType" class="form-label">Fuel Type</label>
                                            <select id="profileFuelType" class="form-select">
                                                <option value="">Select Fuel Type</option>
                                                <option value="Petrol">Petrol</option>
                                                <option value="Diesel">Diesel</option>
                                                <option value="Electric">Electric</option>
                                                <option value="Hybrid">Hybrid</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="profileEducation" class="form-label">Highest Educational Qualification</label>
                                            <select id="profileEducation" class="form-select">
                                                <option value="">Select Qualification</option>
                                                <option value="High School">High School</option>
                                                <option value="Diploma">Diploma</option>
                                                <option value="Bachelors Degree">Bachelor's Degree</option>
                                                <option value="Masters Degree">Master's Degree</option>
                                                <option value="PhD">PhD</option>
                                                <option value="Other">Other</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6 mb-3" id="serviceYearsContainer" style="display: none;">
                                            <label for="profileServiceYears" class="form-label">Years of Service</label>
                                            <select id="profileServiceYears" class="form-select">
                                                <option value="">Select Range</option>
                                                <option value="0-1">0 - 1 years</option>
                                                <option value="2-5">2 - 5 years</option>
                                                <option value="6-10">6 - 10 years</option>
                                                <option value="11-15">11 - 15 years</option>
                                                <option value="15+">15+ years</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 mb-3" id="spouseStatusContainer" style="display: none;">
                                            <label for="profileSpouseStatus" class="form-label">Spouse's Working Status</label>
                                            <select id="profileSpouseStatus" class="form-select">
                                                <option value="">Select Status</option>
                                                <option value="Working">Working</option>
                                                <option value="Not Working">Not Working</option>
                                                <option value="Student">Student</option>
                                                <option value="Retired">Retired</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-12 mb-3">
                                            <label for="profileInterests" class="form-label">Interests</label>
                                            <textarea id="profileInterests" class="form-control" rows="3" placeholder="e.g., Reading, Traveling, Sports"></textarea>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-primary"><i class="fas fa-save me-2"></i>Save Changes</button>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="v-pills-financial" role="tabpanel" aria-labelledby="v-pills-financial-tab">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title mb-4">Financial Information</h4>
                                <form id="financialForm">
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="savingMode" class="form-label">Saving Mode</label>
                                            <select id="savingMode" class="form-select">
                                                <option value="">Select Saving Mode</option>
                                                <option value="Simple">Simple</option>
                                                <option value="Moderate">Moderate</option>
                                                <option value="Aggressive">Aggressive</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="minSavingsTarget" class="form-label">Monthly Minimum Savings Target</label>
                                            <input type="number" id="minSavingsTarget" class="form-control" min="0">
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-primary mt-3"><i class="fas fa-save me-2"></i>Save Financial Info</button>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="v-pills-categories" role="tabpanel" aria-labelledby="v-pills-categories-tab">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title mb-4">Categories</h4>
                                <h5 class="text-primary"><i class="fas fa-arrow-up text-success"></i> Income Categories</h5>
                                <p class="text-muted mb-3">Select the income categories you want to track</p>
                                <div class="border rounded p-3 mb-4" style="max-height: 300px; overflow-y: auto;">
                                    <div id="incomeCategoriesList" class="row"></div>
                                </div>
                                <div class="input-group mb-4">
                                    <input type="text" id="customIncomeCategory" class="form-control" placeholder="Add custom income category" autocomplete="nope">
                                    <button class="btn btn-outline-primary" type="button" onclick="addCustomCategory('income')"><i class="fas fa-plus"></i> Add</button>
                                </div>

                                <h5 class="text-primary"><i class="fas fa-arrow-down text-danger"></i> Expense Categories</h5>
                                <p class="text-muted mb-3">Select the expense categories you want to track</p>
                                <div class="border rounded p-3 mb-4" style="max-height: 300px; overflow-y: auto;">
                                    <div id="expenseCategoriesList" class="row"></div>
                                </div>
                                <div class="input-group mb-4">
                                    <input type="text" id="customExpenseCategory" class="form-control" placeholder="Add custom expense category" autocomplete="nope">
                                    <button class="btn btn-outline-primary" type="button" onclick="addCustomCategory('expense')"><i class="fas fa-plus"></i> Add</button>
                                </div>
                                <button type="button" class="btn btn-primary mt-4" id="saveCategoriesBtn"><i class="fas fa-save me-2"></i>Save Categories</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tab-pane fade" id="v-pills-preferences" role="tabpanel" aria-labelledby="v-pills-preferences-tab">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title mb-4">Preferences</h4>
                                <form id="preferencesForm">
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="profileCurrency" class="form-label">Currency</label>
                                            <select id="profileCurrency" class="form-select" required>
                                                <option value="">Select Currency</option>
                                                </select>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="profileCycleDate" class="form-label">Cycle Date</label>
                                            <select id="profileCycleDate" class="form-select">
                                                <option value="">Select Cycle Date</option>
                                                <option value="1">1st</option>
                                                <option value="5">5th</option>
                                                <option value="10">10th</option>
                                                <option value="15">15th</option>
                                                <option value="20">20th</option>
                                                <option value="25">25th</option>
                                                <option value="30">30th</option>
                                            </select>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-primary mt-3"><i class="fas fa-save me-2"></i>Save Preferences</button>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="v-pills-billing" role="tabpanel" aria-labelledby="v-pills-billing-tab">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title mb-4">Billing & Subscription</h4>
                                <p>Manage your subscription.</p>
                                
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="v-pills-security" role="tabpanel" aria-labelledby="v-pills-security-tab">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title mb-4">Security</h4>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="currentPassword" class="form-label" defaultValue=null>Current Password</label>
                                        <input type="password" id="currentPassword" class="form-control">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="newPassword" class="form-label">New Password</label>
                                        <input type="password" id="newPassword" class="form-control">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="confirmNewPassword" class="form-label">Confirm New Password</label>
                                        <input type="password" id="confirmNewPassword" class="form-control">
                                    </div>
                                </div>
                                <button type="button" class="btn btn-primary" id="changePasswordBtn">Change Password</button>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="v-pills-danger" role="tabpanel" aria-labelledby="v-pills-danger-tab">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title mb-4">Danger Zone</h4>
                                <p>Deleting your account is a permanent action and cannot be undone.</p>
                                <button type="button" class="btn btn-danger" id="deleteAccountBtn"><i class="fas fa-user-times me-2"></i>Delete Account</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="deleteAccountModal" tabindex="-1" aria-labelledby="deleteAccountModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteAccountModalLabel">Confirm Account Deletion</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete your account? This action cannot be undone and will permanently delete all your data.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteAccount">Delete Account</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script type="module">
        // Firebase SDKs
        import { getAuth, onAuthStateChanged, signOut, deleteUser, EmailAuthProvider, reauthenticateWithCredential, updatePassword } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, collection, getDocs, deleteDoc, writeBatch } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import { auth, db } from "./firebase-config.js";

        const profileForm = document.getElementById('profileForm');
        const financialForm = document.getElementById('financialForm');
        const preferencesForm = document.getElementById('preferencesForm');
        const logoutButton = document.getElementById('logoutButton');

        // --- Data Definitions ---
        const incomeCategories = ["Salary", "Gift", "Bonus", "Interest", "Business Income", "Others"];
        const expenseCategories = ["Food", "Transport", "Utilities", "Cash Withdraw", "Health", "Loans", "Clothing", "Household", "Savings", "Entertainment", "Others"];
        const currencyList = [
            { code: "USD", name: "United States Dollar" }, { code: "EUR", name: "Euro" }, { code: "JPY", name: "Japanese Yen" },
            { code: "GBP", name: "British Pound" }, { code: "AUD", name: "Australian Dollar" }, { code: "CAD", name: "Canadian Dollar" },
            { code: "CHF", name: "Swiss Franc" }, { code: "CNY", name: "Chinese Yuan" }, { code: "INR", name: "Indian Rupee" },
            { code: "LKR", name: "Sri Lankan Rupee" }, { code: "BRL", name: "Brazilian Real" }, { code: "RUB", name: "Russian Ruble" },
            { code: "ZAR", name: "South African Rand" }, { code: "SGD", name: "Singapore Dollar" }, { code: "AED", name: "UAE Dirham" }
        ];
        
        let categoriesWithTransactions = { income: new Set(), expense: new Set() };
        let customCategories = { income: [], expense: [] };

        // --- UI Population Functions ---
        function populateCurrencies() {
            const currencySelect = document.getElementById('profileCurrency');
            currencyList.sort((a,b) => a.name.localeCompare(b.name));
            currencyList.forEach(currency => {
                const option = document.createElement('option');
                option.value = currency.code;
                option.textContent = `${currency.code} - ${currency.name}`;
                currencySelect.appendChild(option);
            });
        }

        async function loadUserProfile() {
            const user = auth.currentUser;
            if (user) {
                try {
                    const userDoc = await getDoc(doc(db, "users", user.uid));
                    if (userDoc.exists()) {
                        const userData = userDoc.data();
                        
                        // Personal Info
                        document.getElementById('profileEmail').value = user.email;
                        document.getElementById('profileFirstname').value = userData.firstname || '';
                        document.getElementById('profileLastname').value = userData.lastname || '';
                        document.getElementById('profilePhone').value = userData.phone || '';
                        document.getElementById('profileProfession').value = userData.profession || '';
                        document.getElementById('profileAgeRange').value = userData.ageRange || '';
                        document.getElementById('profileCountry').value = userData.country || '';
                        document.getElementById('profileIncomeRange').value = userData.incomeRange || '';
                        document.getElementById('profileCivilStatus').value = userData.civilStatus || '';
                        document.getElementById('profileChildren').value = userData.children || '';
                        document.getElementById('profileLivingType').value = userData.livingType || '';
                        document.getElementById('profileVehicleOwned').value = userData.vehicleOwned || '';
                        document.getElementById('profileFuelType').value = userData.fuelType || '';
                        document.getElementById('profileInterests').value = userData.interests || '';
                        document.getElementById('profileEducation').value = userData.education || '';
                        document.getElementById('profileServiceYears').value = userData.serviceYears || '';
                        document.getElementById('profileSpouseStatus').value = userData.spouseStatus || '';

                        // Preferences Info
                        document.getElementById('profileCycleDate').value = userData.cycleDate || '';
                        document.getElementById('profileCurrency').value = userData.currency || '';

                        // Trigger change events to show/hide conditional fields
                        document.getElementById('profileVehicleOwned').dispatchEvent(new Event('change'));
                        document.getElementById('profileProfession').dispatchEvent(new Event('change'));
                        document.getElementById('profileCivilStatus').dispatchEvent(new Event('change'));

                        // Financial Info
                        document.getElementById('savingMode').value = userData.savingMode || '';
                        document.getElementById('minSavingsTarget').value = userData.minSavingsTarget || '';

                        // Categories
                        customCategories.income = userData.customIncomeCategories || [];
                        customCategories.expense = userData.customExpenseCategories || [];
                        const selectedIncome = userData.selectedIncomeCategories || [...incomeCategories, ...customCategories.income];
                        const selectedExpense = userData.selectedExpenseCategories || [...expenseCategories, ...customCategories.expense];
                        await checkExistingTransactions(user.uid);
                        populateCategories('income', [...incomeCategories, ...customCategories.income], selectedIncome);
                        populateCategories('expense', [...expenseCategories, ...customCategories.expense], selectedExpense);
                    } else {
                        console.log('No user document found, setting up defaults');
                        populateCategories('income', incomeCategories, incomeCategories);
                        populateCategories('expense', expenseCategories, expenseCategories);
                    }
                } catch (error) {
                    console.error('Error loading user profile:', error);
                    populateCategories('income', incomeCategories, incomeCategories);
                    populateCategories('expense', expenseCategories, expenseCategories);
                }
            }
        }

        async function checkExistingTransactions(userId) {
            try {
                const transactionsRef = collection(db, "users", userId, "transactions");
                const snapshot = await getDocs(transactionsRef);
                snapshot.forEach(doc => {
                    const transaction = doc.data();
                    if (transaction.type === "Income" && transaction.category) {
                        categoriesWithTransactions.income.add(transaction.category);
                    } else if (transaction.type === "Expense" && transaction.category) {
                        categoriesWithTransactions.expense.add(transaction.category);
                    }
                });
            } catch (error) {
                console.error("Error checking existing transactions:", error);
            }
        }

        function populateCategories(type, allCategories, selectedCategories) {
            const container = document.getElementById(`${type}CategoriesList`);
            if (!container) return;
            container.innerHTML = '';
            
            allCategories.forEach(category => {
                const col = document.createElement('div');
                col.className = 'col-md-6 mb-2';
                const hasTransactions = (type === 'income') ? categoriesWithTransactions.income.has(category) : categoriesWithTransactions.expense.has(category);
                const isSelected = selectedCategories.includes(category);
                const isCustom = (type === 'income' ? customCategories.income : customCategories.expense).includes(category);
                const checkboxId = `${type}_${category.replace(/\s+/g, '_')}`;
                
                let categoryDisplay = `
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="${checkboxId}" value="${category}" ${isSelected ? 'checked' : ''} ${hasTransactions ? 'disabled' : ''}>
                        <label class="form-check-label" for="${checkboxId}">
                            ${category}
                            ${isCustom ? '<small class="text-info"> (custom)</small>' : ''}
                        </label>`;
                
                if (isCustom && !hasTransactions) {
                    categoryDisplay += `<button type="button" class="btn btn-sm btn-outline-danger ms-2" onclick="removeCustomCategory('${type}', '${category}')"><i class="fas fa-times"></i></button>`;
                }
                
                categoryDisplay += `</div>`;
                col.innerHTML = categoryDisplay;
                container.appendChild(col);
            });
        }

        function getSelectedCategories(type) {
            return Array.from(document.querySelectorAll(`#${type}CategoriesList input[type="checkbox"]:checked`)).map(cb => cb.value);
        }

        // --- Event Handlers and Listeners ---
        window.addCustomCategory = function(type) {
            const inputId = type === 'income' ? 'customIncomeCategory' : 'customExpenseCategory';
            const input = document.getElementById(inputId);
            const categoryName = input.value.trim();
            if (!categoryName) { alert('Please enter a category name'); return; }
            
            const allCategories = (type === 'income') ? [...incomeCategories, ...customCategories.income] : [...expenseCategories, ...customCategories.expense];
            if (allCategories.some(cat => cat.toLowerCase() === categoryName.toLowerCase())) { alert('This category already exists'); return; }
            
            customCategories[type].push(categoryName);
            const selectedCategories = getSelectedCategories(type);
            selectedCategories.push(categoryName);
            const updatedAllCategories = (type === 'income') ? [...incomeCategories, ...customCategories.income] : [...expenseCategories, ...customCategories.expense];
            populateCategories(type, updatedAllCategories, selectedCategories);
            input.value = '';
        };

        window.removeCustomCategory = function(type, category) {
            if ((type === 'income' ? categoriesWithTransactions.income.has(category) : categoriesWithTransactions.expense.has(category))) { alert('Cannot remove category with existing transactions'); return; }
            customCategories[type] = customCategories[type].filter(cat => cat !== category);
            const selectedCategories = getSelectedCategories(type).filter(cat => cat !== category);
            populateCategories(type, (type === 'income' ? [...incomeCategories, ...customCategories.income] : [...expenseCategories, ...customCategories.expense]), selectedCategories);
        };

        profileForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const user = auth.currentUser;
            if (user) {
                try {
                    await setDoc(doc(db, "users", user.uid), {
                        firstname: document.getElementById('profileFirstname').value,
                        lastname: document.getElementById('profileLastname').value,
                        phone: document.getElementById('profilePhone').value,
                        profession: document.getElementById('profileProfession').value,
                        ageRange: document.getElementById('profileAgeRange').value,
                        country: document.getElementById('profileCountry').value,
                        incomeRange: document.getElementById('profileIncomeRange').value,
                        civilStatus: document.getElementById('profileCivilStatus').value,
                        children: document.getElementById('profileChildren').value,
                        livingType: document.getElementById('profileLivingType').value,
                        vehicleOwned: document.getElementById('profileVehicleOwned').value,
                        fuelType: document.getElementById('profileFuelType').value,
                        interests: document.getElementById('profileInterests').value,
                        education: document.getElementById('profileEducation').value,
                        serviceYears: document.getElementById('profileServiceYears').value,
                        spouseStatus: document.getElementById('profileSpouseStatus').value,
                        email: user.email,
                        updatedAt: new Date().toISOString()
                    }, { merge: true });
                    alert('Profile updated successfully!');
                } catch (error) {
                    console.error('Error updating profile:', error);
                    alert('Error updating profile. Please try again.');
                }
            }
        });

        financialForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const user = auth.currentUser;
            if(user) {
                try {
                    await setDoc(doc(db, "users", user.uid), {
                        savingMode: document.getElementById('savingMode').value,
                        minSavingsTarget: document.getElementById('minSavingsTarget').value,
                        updatedAt: new Date().toISOString()
                    }, { merge: true });
                    alert('Financial information updated successfully!');
                } catch (error) {
                    console.error('Error updating financial information:', error);
                    alert('Error updating financial information. Please try again.');
                }
            }
        });

        preferencesForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const user = auth.currentUser;
            if (user) {
                try {
                    const newCycleDate = document.getElementById('profileCycleDate').value;
                    const newCurrency = document.getElementById('profileCurrency').value;

                    await setDoc(doc(db, "users", user.uid), {
                        cycleDate: newCycleDate,
                        currency: newCurrency,
                        updatedAt: new Date().toISOString()
                    }, { merge: true });

                    alert('Preferences updated successfully!');
                } catch (error) {
                    console.error('Error updating preferences:', error);
                    alert('Error updating preferences. Please try again.');
                }
            }
        });

        // ** THIS IS THE FIXED CODE FOR THE SAVE CATEGORIES BUTTON **
        document.getElementById('saveCategoriesBtn').addEventListener('click', async () => {
            const user = auth.currentUser;
            if (user) {
                try {
                    const selectedIncome = getSelectedCategories('income');
                    const selectedExpense = getSelectedCategories('expense');

                    await setDoc(doc(db, "users", user.uid), {
                        customIncomeCategories: customCategories.income,
                        customExpenseCategories: customCategories.expense,
                        selectedIncomeCategories: selectedIncome,
                        selectedExpenseCategories: selectedExpense,
                        updatedAt: new Date().toISOString()
                    }, { merge: true });

                    alert('Categories updated successfully!');
                } catch (error) {
                    console.error('Error updating categories:', error);
                    alert('Error updating categories. Please try again.');
                }
            }
        });

        document.getElementById('changePasswordBtn').addEventListener('click', async () => {
            const user = auth.currentUser;
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmNewPassword = document.getElementById('confirmNewPassword').value;

            if (!currentPassword || !newPassword || !confirmNewPassword) {
                alert('Please fill in all password fields.');
                return;
            }
            if (newPassword !== confirmNewPassword) {
                alert('New passwords do not match.');
                return;
            }
            if (newPassword.length < 6) {
                alert('New password must be at least 6 characters long.');
                return;
            }

            if (user) {
                const credential = EmailAuthProvider.credential(user.email, currentPassword);
                try {
                    await reauthenticateWithCredential(user, credential);
                    await updatePassword(user, newPassword);
                    alert('Password updated successfully!');
                    document.getElementById('currentPassword').value = '';
                    document.getElementById('newPassword').value = '';
                    document.getElementById('confirmNewPassword').value = '';
                } catch (error) {
                    console.error('Error changing password:', error);
                    if (error.code === 'auth/wrong-password') {
                        alert('Incorrect current password.');
                    } else if (error.code === 'auth/requires-recent-login') {
                        alert('This operation is sensitive and requires recent authentication. Please log in again before retrying this request.');
                    } else {
                        alert('An error occurred while changing your password. Please try again.');
                    }
                }
            }
        });

        logoutButton.addEventListener('click', async () => {
            try {
                await signOut(auth);
                window.location.href = 'index.html';
            } catch (error) {
                console.error('Error signing out:', error);
            }
        });

        async function deleteAccount() {
            const user = auth.currentUser;
            if (user) {
                try {
                    // Delete all transactions first
                    const batch = writeBatch(db);
                    const transactionsRef = collection(db, "users", user.uid, "transactions");
                    const snapshot = await getDocs(transactionsRef);
                    snapshot.forEach((doc) => {
                        batch.delete(doc.ref);
                    });
                    await batch.commit();
                    
                    // Delete the user document
                    await deleteDoc(doc(db, "users", user.uid));
                    
                    // Delete the user from auth
                    await deleteUser(user);
                    
                    alert("Your account has been successfully deleted.");
                    window.location.href = "index.html";

                } catch (error) {
                    console.error("Error deleting account:", error);
                    if (error.code === 'auth/requires-recent-login') {
                        const password = prompt("Please re-enter your password to confirm account deletion.");
                        if (password) {
                            const credential = EmailAuthProvider.credential(user.email, password);
                            try {
                                await reauthenticateWithCredential(user, credential);
                                await deleteAccount(); // Retry deletion
                            } catch (reauthError) {
                                console.error("Re-authentication failed:", reauthError);
                                alert("Incorrect password. Account deletion failed.");
                            }
                        } else {
                            alert("Password not provided. Account deletion cancelled.");
                        }
                    } else {
                        alert("An error occurred while deleting your account. Please try again.");
                    }
                }
            }
        }

        const deleteAccountBtn = document.getElementById('deleteAccountBtn');
        const confirmDeleteAccount = document.getElementById('confirmDeleteAccount');
        const deleteAccountModal = new bootstrap.Modal(document.getElementById('deleteAccountModal'));

        deleteAccountBtn.addEventListener('click', () => {
            deleteAccountModal.show();
        });

        confirmDeleteAccount.addEventListener('click', async () => {
            deleteAccountModal.hide();
            await deleteAccount();
        });

        document.getElementById('profileVehicleOwned').addEventListener('change', function () {
            document.getElementById('profileFuelTypeContainer').style.display = this.value === 'Yes' ? 'block' : 'none';
        });
        
        document.getElementById('profileProfession').addEventListener('change', function () {
            const container = document.getElementById('serviceYearsContainer');
            container.style.display = this.value === 'Employed' ? 'block' : 'none';
            if (this.value !== 'Employed') {
                document.getElementById('profileServiceYears').value = '';
            }
        });

        document.getElementById('profileCivilStatus').addEventListener('change', function () {
            const container = document.getElementById('spouseStatusContainer');
            container.style.display = this.value === 'Married' ? 'block' : 'none';
            if (this.value !== 'Married') {
                document.getElementById('profileSpouseStatus').value = '';
            }
        });

        // --- Auth State and Initial Load ---
        onAuthStateChanged(auth, (user) => {
            if (user) {
                populateCurrencies();
                loadUserProfile();
            } else {
                window.location.href = 'index.html';
            }
        });
    </script>
</body>
</html>