<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Enhanced Financial Dashboard</title>
    <link rel="stylesheet" href="ai-enhanced-styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="ai-demo-data.js"></script>
    <script src="ai-dashboard-engine.js"></script>
</head>
<body>
    <div class="ai-dashboard-container">
        <!-- AI Status Bar -->
        <div class="ai-status-bar">
            <div class="ai-status-indicator">
                <i class="fas fa-brain"></i>
                <span>AI Engine: <span id="ai-status">Initializing...</span></span>
            </div>
            <div class="ai-performance">
                <span>Accuracy: <span id="ai-accuracy">87%</span></span>
                <span>Last Update: <span id="last-update">Just now</span></span>
            </div>
        </div>

        <!-- Header -->
        <header class="ai-header">
            <div class="ai-header-content">
                <h1><i class="fas fa-robot"></i> AI Financial Dashboard</h1>
                <div class="ai-controls">
                    <button class="ai-btn" onclick="refreshAI()">
                        <i class="fas fa-sync-alt"></i> Refresh AI
                    </button>
                    <button class="ai-btn" onclick="exportInsights()">
                        <i class="fas fa-download"></i> Export Insights
                    </button>
                </div>
            </div>
        </header>

        <!-- AI Assistant Panel -->
        <div class="ai-assistant-panel">
            <div class="ai-chat-header">
                <i class="fas fa-comments"></i>
                <span>AI Assistant</span>
                <button class="ai-chat-toggle" onclick="toggleChat()">
                    <i class="fas fa-chevron-down"></i>
                </button>
            </div>
            <div class="ai-chat-body" id="ai-chat-body">
                <div class="ai-chat-messages" id="ai-chat-messages">
                    <div class="ai-message ai-assistant">
                        <div class="ai-avatar">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="ai-content">
                            <p>Hello! I'm your AI financial assistant. I can help you understand your spending, detect anomalies, and provide personalized recommendations. What would you like to know?</p>
                        </div>
                    </div>
                </div>
                <div class="ai-chat-input">
                    <input type="text" id="ai-chat-input" placeholder="Ask me anything about your finances..." onkeypress="handleChatInput(event)">
                    <button onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>
        </div>

        <!-- Main Dashboard Grid -->
        <div class="ai-dashboard-grid">
            <!-- AI Overview Cards -->
            <div class="ai-card ai-overview-card">
                <div class="ai-card-header">
                    <h3><i class="fas fa-chart-line"></i> AI Overview</h3>
                    <span class="ai-badge">Live</span>
                </div>
                <div class="ai-overview-stats">
                    <div class="ai-stat">
                        <div class="ai-stat-value" id="total-spending">$0</div>
                        <div class="ai-stat-label">Total Spending</div>
                    </div>
                    <div class="ai-stat">
                        <div class="ai-stat-value" id="anomaly-count">0</div>
                        <div class="ai-stat-label">Anomalies</div>
                    </div>
                    <div class="ai-stat">
                        <div class="ai-stat-value" id="prediction-confidence">0%</div>
                        <div class="ai-stat-label">Confidence</div>
                    </div>
                </div>
            </div>

            <!-- Spending Predictions -->
            <div class="ai-card ai-predictions-card">
                <div class="ai-card-header">
                    <h3><i class="fas fa-crystal-ball"></i> Spending Predictions</h3>
                    <select id="prediction-period" onchange="updatePredictions()">
                        <option value="7">Next 7 Days</option>
                        <option value="30" selected>Next 30 Days</option>
                        <option value="90">Next 90 Days</option>
                    </select>
                </div>
                <div class="ai-prediction-content">
                    <div class="ai-prediction-amount" id="predicted-amount">$0</div>
                    <div class="ai-prediction-breakdown" id="prediction-breakdown"></div>
                    <canvas id="prediction-chart" width="400" height="200"></canvas>
                </div>
            </div>

            <!-- Anomaly Detection -->
            <div class="ai-card ai-anomalies-card">
                <div class="ai-card-header">
                    <h3><i class="fas fa-exclamation-triangle"></i> Anomaly Detection</h3>
                    <button class="ai-btn-small" onclick="refreshAnomalies()">
                        <i class="fas fa-search"></i> Scan
                    </button>
                </div>
                <div class="ai-anomalies-list" id="anomalies-list">
                    <!-- Anomalies will be populated here -->
                </div>
            </div>

            <!-- AI Recommendations -->
            <div class="ai-card ai-recommendations-card">
                <div class="ai-card-header">
                    <h3><i class="fas fa-lightbulb"></i> AI Recommendations</h3>
                    <div class="ai-filter">
                        <select id="recommendation-filter" onchange="filterRecommendations()">
                            <option value="all">All</option>
                            <option value="high">High Priority</option>
                            <option value="medium">Medium Priority</option>
                            <option value="low">Low Priority</option>
                        </select>
                    </div>
                </div>
                <div class="ai-recommendations-list" id="recommendations-list">
                    <!-- Recommendations will be populated here -->
                </div>
            </div>

            <!-- Spending Patterns -->
            <div class="ai-card ai-patterns-card">
                <div class="ai-card-header">
                    <h3><i class="fas fa-chart-pie"></i> Spending Patterns</h3>
                    <button class="ai-btn-small" onclick="showDetailedInsights('spending')">
                        <i class="fas fa-info-circle"></i> Details
                    </button>
                </div>
                <div class="ai-patterns-content">
                    <canvas id="patterns-chart" width="400" height="300"></canvas>
                </div>
            </div>

            <!-- Real-time Feed -->
            <div class="ai-card ai-feed-card">
                <div class="ai-card-header">
                    <h3><i class="fas fa-rss"></i> Real-time AI Feed</h3>
                    <div class="ai-live-indicator">
                        <span class="ai-pulse"></span>
                        Live
                    </div>
                </div>
                <div class="ai-feed-content" id="ai-feed">
                    <!-- Real-time updates will appear here -->
                </div>
            </div>
        </div>

        <!-- Detailed Insights Modal -->
        <div class="ai-modal" id="insights-modal">
            <div class="ai-modal-content">
                <div class="ai-modal-header">
                    <h3 id="insights-title">Detailed Insights</h3>
                    <button class="ai-modal-close" onclick="closeInsightsModal()">&times;</button>
                </div>
                <div class="ai-modal-body" id="insights-body">
                    <!-- Detailed insights will be populated here -->
                </div>
            </div>
        </div>

        <!-- AI Performance Dashboard -->
        <div class="ai-performance-panel">
            <h3><i class="fas fa-tachometer-alt"></i> AI Performance</h3>
            <div class="ai-metrics">
                <div class="ai-metric">
                    <span class="ai-metric-label">Model Accuracy</span>
                    <span class="ai-metric-value" id="model-accuracy">87%</span>
                </div>
                <div class="ai-metric">
                    <span class="ai-metric-label">Response Time</span>
                    <span class="ai-metric-value" id="response-time">< 200ms</span>
                </div>
                <div class="ai-metric">
                    <span class="ai-metric-label">Data Quality</span>
                    <span class="ai-metric-value" id="data-quality">98%</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        let predictionChart = null;
        let patternsChart = null;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', async () => {
            await aiEngine.initialize();
            updateDashboard();
            startRealTimeUpdates();
            initializeCharts();
        });

        async function updateDashboard() {
            updateOverview();
            updatePredictions();
            updateAnomalies();
            updateRecommendations();
            updatePatterns();
            updateAIStatus();
        }

        function updateOverview() {
            const totalSpending = Math.abs(aiEngine.data.transactions
                .filter(t => new Date(t.date) > new Date(Date.now() - 30 * 24 * 60 * 60 * 1000))
                .reduce((sum, t) => sum + t.amount, 0)).toFixed(2);
            
            const anomalyCount = aiEngine.data.anomalies.length;
            const confidence = aiEngine.models.spendingPredictor.accuracy * 100;

            document.getElementById('total-spending').textContent = `$${totalSpending}`;
            document.getElementById('anomaly-count').textContent = anomalyCount;
            document.getElementById('prediction-confidence').textContent = `${confidence}%`;
        }

        async function updatePredictions() {
            const period = parseInt(document.getElementById('prediction-period').value);
            const prediction = aiEngine.predictSpending(period);
            
            document.getElementById('predicted-amount').textContent = `$${prediction.predictedAmount}`;
            
            const breakdown = document.getElementById('prediction-breakdown');
            breakdown.innerHTML = prediction.breakdown
                .map(item => `<span class="ai-breakdown-item">${item.category}: $${item.predictedAmount} (${item.percentage}%)</span>`)
                .join('');
            
            updatePredictionChart(prediction);
        }

        function updatePredictionChart(prediction) {
            const ctx = document.getElementById('prediction-chart').getContext('2d');
            
            if (predictionChart) {
                predictionChart.destroy();
            }
            
            predictionChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 30}, (_, i) => `Day ${i + 1}`),
                    datasets: [{
                        label: 'Predicted Spending',
                        data: aiEngine.data.predictions.map(p => p.predicted),
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }

        function updateAnomalies() {
            const anomalies = aiEngine.data.anomalies;
            const container = document.getElementById('anomalies-list');
            
            container.innerHTML = anomalies.map(anomaly => `
                <div class="ai-anomaly-item ${anomaly.severity}">
                    <div class="ai-anomaly-header">
                        <span class="ai-anomaly-merchant">${anomaly.transaction.merchant}</span>
                        <span class="ai-anomaly-amount">-$${Math.abs(anomaly.transaction.amount).toFixed(2)}</span>
                    </div>
                    <div class="ai-anomaly-reason">${anomaly.reason}</div>
                    <div class="ai-anomaly-date">${new Date(anomaly.transaction.date).toLocaleDateString()}</div>
                </div>
            `).join('');
        }

        function updateRecommendations() {
            const recommendations = aiEngine.generateRecommendations();
            const filter = document.getElementById('recommendation-filter').value;
            
            const filtered = filter === 'all' 
                ? recommendations 
                : recommendations.filter(r => r.priority === filter);
            
            const container = document.getElementById('recommendations-list');
            container.innerHTML = filtered.map(rec => `
                <div class="ai-recommendation-item ${rec.priority}">
                    <div class="ai-recommendation-header">
                        <span class="ai-recommendation-title">${rec.title}</span>
                        <span class="ai-recommendation-priority">${rec.priority}</span>
                    </div>
                    <div class="ai-recommendation-message">${rec.message}</div>
                    ${rec.potentialSavings ? `<div class="ai-recommendation-savings">Save $${rec.potentialSavings}/month</div>` : ''}
                    ${rec.action ? `<button class="ai-recommendation-action">${rec.action}</button>` : ''}
                </div>
            `).join('');
        }

        function updatePatterns() {
            const ctx = document.getElementById('patterns-chart').getContext('2d');
            
            if (patternsChart) {
                patternsChart.destroy();
            }
            
            const categoryData = aiEngine.getTopCategories();
            
            patternsChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: categoryData.map(c => c.category),
                    datasets: [{
                        data: categoryData.map(c => c.amount),
                        backgroundColor: [
                            '#667eea', '#764ba2', '#f093fb', '#f5576c',
                            '#4facfe', '#00f2fe', '#43e97b', '#38f9d7'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
        }

        function initializeCharts() {
            updatePredictionChart();
            updatePatterns();
        }

        // Chat functionality
        function toggleChat() {
            const body = document.getElementById('ai-chat-body');
            body.classList.toggle('collapsed');
        }

        function handleChatInput(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        async function sendMessage() {
            const input = document.getElementById('ai-chat-input');
            const message = input.value.trim();
            
            if (!message) return;
            
            addChatMessage(message, 'user');
            input.value = '';
            
            const response = aiEngine.processNLPQuery(message);
            setTimeout(() => {
                addChatMessage(response.response, 'assistant');
            }, 500);
        }

        function addChatMessage(message, sender) {
            const container = document.getElementById('ai-chat-messages');
            const div = document.createElement('div');
            div.className = `ai-message ai-${sender}`;
            
            div.innerHTML = `
                <div class="ai-avatar">
                    <i class="fas fa-${sender === 'user' ? 'user' : 'robot'}"></i>
                </div>
                <div class="ai-content">
                    <p>${message}</p>
                </div>
            `;
            
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        // Real-time updates
        function startRealTimeUpdates() {
            setInterval(async () => {
                const update = await aiEngine.updateRealTimeData();
                if (update.newTransaction) {
                    addRealTimeUpdate(update.newTransaction);
                }
                updateDashboard();
            }, 10000); // Update every 10 seconds
        }

        function addRealTimeUpdate(transaction) {
            const feed = document.getElementById('ai-feed');
            const div = document.createElement('div');
            div.className = 'ai-feed-item';
            
            div.innerHTML = `
                <div class="ai-feed-time">${new Date().toLocaleTimeString()}</div>
                <div class="ai-feed-message">
                    ${transaction.isAnomaly ? '<i class="fas fa-exclamation-triangle"></i>' : '<i class="fas fa-check-circle"></i>'}
                    ${transaction.merchant}: $${Math.abs(transaction.amount).toFixed(2)}
                    ${transaction.isAnomaly ? '<span class="ai-anomaly-tag">Anomaly</span>' : ''}
                </div>
            `;
            
            feed.insertBefore(div, feed.firstChild);
            
            // Keep only last 10 items
            while (feed.children.length > 10) {
                feed.removeChild(feed.lastChild);
            }
        }

        // Utility functions
        function refreshAI() {
            updateDashboard();
            showNotification('AI data refreshed successfully', 'success');
        }

        function exportInsights() {
            const insights = aiEngine.exportInsights();
            const blob = new Blob([insights], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ai-insights.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        function showDetailedInsights(type) {
            const insights = demoData.generateDetailedInsights(type);
            const modal = document.getElementById('insights-modal');
            const title = document.getElementById('insights-title');
            const body = document.getElementById('insights-body');
            
            title.textContent = insights.title;
            body.innerHTML = `
                <div class="ai-insights-analysis">
                    <h4>Analysis</h4>
                    <p>${insights.analysis}</p>
                </div>
                <div class="ai-insights-recommendations">
                    <h4>Recommendations</h4>
                    <ul>
                        ${insights.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                    </ul>
                </div>
                <div class="ai-insights-data">
                    <h4>Key Data Points</h4>
                    <ul>
                        ${insights.dataPoints.map(point => `<li>${point}</li>`).join('')}
                    </ul>
                </div>
            `;
            
            modal.style.display = 'block';
        }

        function closeInsightsModal() {
            document.getElementById('insights-modal').style.display = 'none';
        }

        function updateAIStatus() {
            document.getElementById('ai-status').textContent = 'Active';
            document.getElementById('ai-accuracy').textContent = '87%';
            document.getElementById('last-update').textContent = new Date().toLocaleTimeString();
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `ai-notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Global functions for HTML onclick handlers
        window.refreshAI = refreshAI;
        window.exportInsights = exportInsights;
        window.toggleChat = toggleChat;
        window.showDetailedInsights = showDetailedInsights;
        window.closeInsightsModal = closeInsightsModal;
        window.updatePredictions = updatePredictions;
        window.filterRecommendations = updateRecommendations;
        window.refreshAnomalies = updateAnomalies;
    </script>
</body>
</html>
