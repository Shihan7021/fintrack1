<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Register - FinSight</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        .register-card {
            max-width: 500px;
            width: 100%;
            padding: 2.5rem;
            border-radius: 1rem;
        }
        .form-label {
            margin-bottom: 0.25rem;
        }
        .logo-small {
            max-height: 40px;
            width: auto;
        }

        .btn-login {
            background-color: #3C0775;
            border-color: #3C0775;
            color: #fff;
        }
        .btn-login:hover {
            background-color: #7454AC;
            border-color: #7454AC;
        }
        .btn-primary {
            background-color: #B8A5D2;
            border-color: #B8A5D2;
            color: #fff;
        }

        .btn-primary:hover {
            background-color: #7454AC;
            border-color: #7454AC;
        }
    </style>
</head>
<body class="bg-light">
    <div class="container d-flex flex-column justify-content-center align-items-center min-vh-100">
        <div class="card shadow register-card">
            <img src="logo.png" alt="FinSight Logo" class="logo-small">
            <h4 class="text-center mb-4">Register</h4>

            <form id="registerForm">
                <div class="mb-2">
                    <label for="userEmail" class="form-label">Email</label>
                    <input type="email" id="userEmail" class="form-control" required />
                </div>
                <div class="mb-2">
                    <label for="newPassword" class="form-label">Password</label>
                    <input type="password" id="newPassword" class="form-control" required />
                </div>
                <div class="mb-2">
                    <label for="confirmPassword" class="form-label">Confirm Password</label>
                    <input type="password" id="confirmPassword" class="form-control" required />
                </div>
                <div class="mb-2">
                    <label for="profession" class="form-label">Profession</label>
                    <select id="profession" class="form-select" required>
                        <option value="">Select Profession</option>
                        <option value="Student">Student</option>
                        <option value="Employed">Employed</option>
                        <option value="Self-Employed">Self-Employed</option>
                        <option value="Business Owner">Business Owner</option>
                        <option value="Freelancer">Freelancer</option>
                        <option value="Retired">Retired</option>
                        <option value="Unemployed">Unemployed</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="mb-2">
                    <label for="ageRange" class="form-label">Age Range</label>
                    <select id="ageRange" class="form-select" required>
                        <option value="">Select Age Range</option>
                        <option value="18-25">18-25</option>
                        <option value="26-35">26-35</option>
                        <option value="36-45">36-45</option>
                        <option value="46-55">46-55</option>
                        <option value="56-65">56-65</option>
                        <option value="65+">65+</option>
                    </select>
                </div>
                <div class="mb-2">
                    <label for="country" class="form-label">Country</label>
                    <select id="country" class="form-select" required>
                        <option value="">Select Country</option>
                        <option value="Sri Lanka">Sri Lanka</option>
                        <option value="India">India</option>
                        <option value="United States">United States</option>
                        <option value="United Kingdom">United Kingdom</option>
                        <option value="Canada">Canada</option>
                        <option value="Australia">Australia</option>
                        <option value="Germany">Germany</option>
                        <option value="France">France</option>
                        <option value="Japan">Japan</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="mb-2">
                    <label for="incomeRange" class="form-label">Monthly Income Range</label>
                    <select id="incomeRange" class="form-select" required>
                        <option value="">Select Income Range</option>
                        <option value="0-50000">Rs. 0 - 50,000</option>
                        <option value="50001-100000">Rs. 50,001 - 100,000</option>
                        <option value="100001-200000">Rs. 100,001 - 200,000</option>
                        <option value="200001-500000">Rs. 200,001 - 500,000</option>
                        <option value="500001-1000000">Rs. 500,001 - 1,000,000</option>
                        <option value="1000000+">Rs. 1,000,000+</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="cycleDate" class="form-label">Cycle Date</label>
                    <select id="cycleDate" class="form-select" required>
                        <option value="">Select Cycle Date</option>
                        <option value="1">1st</option>
                        <option value="5">5th</option>
                        <option value="10">10th</option>
                        <option value="15">15th</option>
                        <option value="20">20th</option>
                        <option value="25">25th</option>
                        <option value="30">30th</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-login w-100">Register</button>
                <a href="index.html" class="btn btn-primary mt-2 w-100">Back to Login</a>
            </form>
        </div>
    </div>

    <script type="module">
        // Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAl8wXLzjuHGHohU70LOoObJ7OZUhHpWDQ",
            authDomain: "finsight-567f4.firebaseapp.com",
            projectId: "finsight-567f4",
            storageBucket: "finsight-567f4.firebasestorage.app",
            messagingSenderId: "329662315678",
            appId: "1:329662315678:web:735fbacbca2818e0674f8f",
            measurementId: "G-3BYVY6PE64"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const registerForm = document.getElementById("registerForm");

        registerForm.addEventListener("submit", async function (e) {
            e.preventDefault();

            const email = document.getElementById("userEmail").value.trim();
            const password = document.getElementById("newPassword").value;
            const confirmPassword = document.getElementById("confirmPassword").value;
            const profession = document.getElementById("profession").value;
            const ageRange = document.getElementById("ageRange").value;
            const country = document.getElementById("country").value;
            const incomeRange = document.getElementById("incomeRange").value;
            const cycleDate = document.getElementById("cycleDate").value;

            if (password !== confirmPassword) {
                alert("Passwords do not match.");
                return;
            }

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                
                // Save additional user profile information
                const user = userCredential.user;
                await setDoc(doc(db, "users", user.uid), {
                    email: email,
                    profession: profession,
                    ageRange: ageRange,
                    country: country,
                    incomeRange: incomeRange,
                    cycleDate: cycleDate,
                    createdAt: new Date().toISOString()
                });

                alert("Registration successful! You can now log in.");
                window.location.href = "index.html";
            } catch (error) {
                const errorCode = error.code;
                let errorMessage = "An error occurred during registration.";
                
                // Customize error messages for better user experience
                if (errorCode === 'auth/email-already-in-use') {
                    errorMessage = "The email address is already in use.";
                } else if (errorCode === 'auth/weak-password') {
                    errorMessage = "The password is too weak. It should be at least 6 characters.";
                } else if (errorCode === 'auth/invalid-email') {
                    errorMessage = "The email address is not valid.";
                }
                
                console.error(error);
                alert(errorMessage);
            }
        });
    </script>
</body>
</html>